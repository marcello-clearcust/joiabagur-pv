# T-EP7-001-009: Implement unit tests for AuthenticationService

## Purpose

Create comprehensive unit tests for the AuthenticationService to ensure all authentication business logic works correctly, including credential validation, token generation, and security policies.

## Details

### Test Scenarios
- **Valid credentials**: Should authenticate successfully and return JWT token
- **Invalid username**: Should return authentication failure
- **Invalid password**: Should return authentication failure
- **Inactive user**: Should return user inactive error
- **Rate limiting**: Should enforce 5 failed attempts per 15 minutes
- **LastLoginAt update**: Should update timestamp on successful login

### Testing Approach
- Use xUnit framework with Moq for mocking dependencies
- Mock IUserRepository and IJwtService
- Use Bogus for generating test data
- Test all public methods of AuthenticationService
- Follow AAA pattern (Arrange, Act, Assert)

### Security Testing
- Ensure password verification uses secure comparison
- Test that error messages don't leak user existence information
- Verify rate limiting counters are maintained correctly

### Test Organization
- Tests named with pattern: `MethodName_Scenario_ExpectedResult`
- Example: `Login_WithValidCredentials_ReturnsJwtToken`
- Group related tests in test classes

## Acceptance Criteria

- [ ] Unit tests cover all AuthenticationService public methods
- [ ] All authentication scenarios are tested (happy path, error cases)
- [ ] Security policies are tested (rate limiting, error handling)
- [ ] Tests use Moq for dependency mocking
- [ ] Test naming follows established conventions
- [ ] Tests achieve minimum 70% code coverage for AuthenticationService
- [ ] Tests run successfully in CI/CD pipeline

## Priority
Medium

## Estimation
3 SP

## Dependencies
- T-EP7-001-003 (authentication application service)

## Tags
EP7, HU-EP7-001, tests, unit-tests, xunit, moq, bogus, security

## Links
- User Story: `Documentos/Historias/HU-EP7-001.md`
- Testing Guide: `Documentos/Testing/Backend/02-tests-unitarios.md` (unit testing patterns)
- Authentication Service: `Tickets/EP7/HU-EP7-001/T-EP7-001-003.md`
- Security Requirements: `Documentos/aclaraciones-tecnicas.md` (authentication security)



