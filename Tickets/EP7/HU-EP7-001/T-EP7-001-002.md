# T-EP7-001-002: Implement authentication infrastructure layer

## Purpose

Implement the infrastructure components required for user authentication, including the user repository with Entity Framework Core, JWT service implementation, and database configuration. This provides the concrete implementations of the domain interfaces.

## Details

### User Repository Implementation
- Implement IUserRepository interface using Entity Framework Core
- Include methods for finding users by username, validating credentials, updating LastLoginAt
- Add query methods for user management (list, search, by role)

### JWT Service Implementation
- Implement IJwtService interface for JWT token operations
- Generate JWT tokens with user claims (username, role, userId)
- Validate JWT tokens and extract claims
- Implement token expiration handling (8 hours default)
- Support refresh token functionality

### Database Configuration
- Ensure User entity is properly configured in DbContext
- Add indexes for username (unique constraint)
- Configure relationships if User has dependencies
- Create initial migration for User table

### Password Hashing
- Implement BCrypt password hashing service
- Include password verification methods
- Ensure secure password storage practices

## Acceptance Criteria

- [ ] IUserRepository is implemented with Entity Framework Core
- [ ] IJwtService generates and validates JWT tokens correctly
- [ ] User entity is configured in DbContext with proper constraints
- [ ] Password hashing uses BCrypt with appropriate work factor
- [ ] Database migration is created and tested
- [ ] All authentication infrastructure components can be dependency injected

## Priority
High

## Estimation
5 SP

## Dependencies
- T-EP7-001-001 (User domain entity and interfaces)

## Tags
EP7, HU-EP7-001, infrastructure, entity-framework, jwt, bcrypt

## Links
- User Story: `Documentos/Historias/HU-EP7-001.md`
- Data Model: `Documentos/modelo-de-datos.md` (User entity and indexes)
- Architecture: `Documentos/arquitectura.md` (Infrastructure layer section)
- Testing: `Documentos/Testing/Backend/04-mocking-efcore.md` (for testing guidance)

