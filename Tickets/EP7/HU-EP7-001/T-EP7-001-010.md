# T-EP7-001-010: Implement integration tests for AuthController

## Purpose

Create integration tests for the authentication API endpoint to ensure the complete request-response cycle works correctly, including validation, authentication logic, and proper HTTP responses.

## Details

### Test Scenarios
- **Successful login**: POST /api/auth/login with valid credentials returns 200 with JWT token
- **Invalid credentials**: Returns 401 with generic error message
- **Inactive user**: Returns 401 with appropriate error message
- **Validation errors**: Missing username/password returns 400 with validation details
- **Rate limiting**: Multiple failed attempts trigger 429 Too Many Requests
- **Malformed requests**: Invalid JSON returns 400 Bad Request

### Testing Infrastructure
- Use Testcontainers with PostgreSQL for real database testing
- Use WebApplicationFactory to create test server
- Configure JWT settings for test environment
- Seed test database with known user data

### API Testing
- Test complete HTTP request/response cycle
- Verify JWT token structure and claims
- Test CORS headers and security middleware
- Verify rate limiting headers and behavior
- Test error response formats

### Database Integration
- Verify user data is correctly retrieved from database
- Test LastLoginAt timestamp updates
- Verify password hash validation works with real BCrypt hashes

## Acceptance Criteria

- [ ] Integration tests cover all AuthController endpoints and scenarios
- [ ] Tests use Testcontainers with real PostgreSQL database
- [ ] JWT tokens are properly generated and validated in tests
- [ ] HTTP status codes and response formats are correct
- [ ] Rate limiting behavior is tested and working
- [ ] Database state changes are verified (LastLoginAt updates)
- [ ] Tests run successfully in CI/CD pipeline
- [ ] Tests achieve minimum 70% code coverage for AuthController

## Priority
Medium

## Estimation
5 SP

## Dependencies
- T-EP7-001-004 (authentication API controller)
- T-EP7-001-002 (authentication infrastructure with database setup)

## Tags
EP7, HU-EP7-001, tests, integration-tests, testcontainers, postgresql, webapplicationfactory, api-testing

## Links
- User Story: `Documentos/Historias/HU-EP7-001.md`
- Testing Guide: `Documentos/Testing/Backend/03-testcontainers.md` (Testcontainers setup)
- AuthController: `Tickets/EP7/HU-EP7-001/T-EP7-001-004.md`
- API Standards: `Documentos/arquitectura.md` (API testing patterns)




