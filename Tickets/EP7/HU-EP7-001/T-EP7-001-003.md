# T-EP7-001-003: Implement authentication application service

## Purpose

Implement the AuthenticationService that contains the core business logic for user authentication, including credential validation, token generation, and security policies. This service orchestrates the domain and infrastructure components to provide secure login functionality.

## Details

### Authentication Service Implementation
- Implement IAuthenticationService interface with login method
- Validate user credentials against stored hash
- Handle different authentication scenarios (valid, invalid, inactive user)
- Generate JWT tokens with appropriate claims and expiration
- Update LastLoginAt timestamp on successful authentication
- Implement rate limiting logic (track failed attempts)

### Security Policies
- Implement rate limiting: maximum 5 failed attempts per 15 minutes per username
- Handle account lockout for inactive users
- Log authentication attempts for security auditing
- Prevent timing attacks by consistent response times

### Error Handling
- Return specific error types for different failure scenarios
- Maintain security by not revealing if username exists or not
- Provide appropriate error messages for client consumption

### Integration Points
- Coordinate between IUserRepository and IJwtService
- Handle password verification through secure hashing
- Support both admin and operator role authentication

## Acceptance Criteria

- [ ] AuthenticationService implements IAuthenticationService interface
- [ ] Login method validates credentials and returns appropriate responses
- [ ] JWT tokens are generated with correct claims and expiration
- [ ] Rate limiting is implemented for failed login attempts
- [ ] LastLoginAt is updated on successful authentication
- [ ] Error handling maintains security (no username enumeration)
- [ ] Service is properly registered for dependency injection

## Priority
High

## Estimation
5 SP

## Dependencies
- T-EP7-001-001 (User domain entity and interfaces)
- T-EP7-001-002 (authentication infrastructure layer)

## Tags
EP7, HU-EP7-001, application, authentication, security, jwt

## Links
- User Story: `Documentos/Historias/HU-EP7-001.md`
- Security Requirements: `Documentos/aclaraciones-tecnicas.md` (JWT and security section)
- Architecture: `Documentos/arquitectura.md` (Application layer section)
- Testing: `Documentos/Testing/Backend/02-tests-unitarios.md` (for unit testing guidance)



