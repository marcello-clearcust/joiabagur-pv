# HU-EP1-001: Importar productos desde Excel

## Formato estándar

Como **administrador**, quiero **importar productos desde un archivo Excel** para **cargar o actualizar el catálogo de productos de forma masiva**.

---

## Descripción

El sistema debe permitir importar productos desde un archivo Excel (.xlsx o .xls). Si el SKU existe, se actualiza el producto; si no existe, se crea uno nuevo. Antes de confirmar, se deben validar los datos y mostrar errores para corrección.

**Formato Excel requerido:**
- Columnas: SKU (obligatorio, único), Name (obligatorio), Description (opcional), Price (obligatorio, > 0), Collection (opcional)

---

## Criterios de Aceptación

### Escenario 1: Importar productos nuevos exitosamente
**Dado que** soy un administrador autenticado  
**Y** tengo un archivo Excel con productos nuevos (SKUs no existentes)  
**Cuando** subo el archivo y confirmo la importación  
**Entonces** el sistema crea todos los productos nuevos  
**Y** se muestran los productos creados con confirmación  
**Y** los productos quedan con `IsActive = true`

### Escenario 2: Actualizar productos existentes
**Dado que** existen productos con SKUs "JOY-001" y "JOY-002"  
**Cuando** importo un Excel con los mismos SKUs pero información actualizada  
**Entonces** el sistema actualiza Name, Description, Price y Collection de esos productos  
**Y** se mantiene el `Id` y las fotos asociadas  
**Y** se actualiza `UpdatedAt`

### Escenario 3: Mezcla de productos nuevos y existentes
**Dado que** importo un Excel con algunos SKUs existentes y otros nuevos  
**Cuando** confirmo la importación  
**Entonces** el sistema actualiza los productos existentes  
**Y** crea los productos nuevos  
**Y** muestra resumen con cantidad de actualizados y creados

### Escenario 4: Validación antes de importar
**Dado que** tengo un archivo Excel con errores (SKU vacío, precio inválido)  
**Cuando** subo el archivo  
**Entonces** el sistema valida los datos  
**Y** muestra lista de errores por fila antes de confirmar  
**Y** no importa ningún producto hasta corregir errores

### Escenario 5: SKU duplicado en el archivo
**Dado que** el archivo Excel tiene el mismo SKU en múltiples filas  
**Cuando** intento importar  
**Entonces** el sistema detecta la duplicación  
**Y** muestra error: "SKU duplicado en el archivo: [SKU]"  
**Y** no permite importar hasta corregir

### Escenario 6: Crear colección automáticamente
**Dado que** importo un producto con Collection "NuevaColección" que no existe  
**Cuando** confirmo la importación  
**Entonces** el sistema crea automáticamente la colección "NuevaColección"  
**Y** asigna el producto a esa colección

---

## Notas adicionales

- **Validaciones:** SKU único, Name requerido, Price > 0, formato de archivo válido
- **Procesamiento:** Usar transacciones para garantizar atomicidad (todo o nada)
- **UX:** Mostrar preview antes de confirmar, permitir descargar plantilla Excel de ejemplo

---

## Tareas

1. Backend: Endpoint `POST /api/products/import` con procesamiento de Excel
2. Backend: Servicio de importación con validaciones y UPSERT por SKU
3. Backend: Creación automática de colecciones si no existen
4. Frontend: Componente de carga de archivo con preview y validación
5. Frontend: Mostrar errores y permitir corrección antes de confirmar

---

## Estimaciones y atributos de priorización

- **Puntos de historia:** _Pendiente_
- **Dependencias:** HU-EP7-001, HU-EP7-006

