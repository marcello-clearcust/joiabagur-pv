# HU-EP4-001: Reconocimiento de productos mediante imagen

## Formato estándar

Como **operador**, quiero **identificar productos mediante reconocimiento de imágenes con IA** para **obtener sugerencias de productos a partir de una foto capturada**.

---

## Descripción

Sistema completo de reconocimiento de imágenes que incluye captura de foto, procesamiento con modelo de IA en cliente (TensorFlow.js/ONNX.js), generación de 3 sugerencias ordenadas por confianza, visualización de sugerencias y selección del producto correcto. Si no hay correspondencia fiable, ofrece tomar otra foto o registrar venta manual.

**Flujo completo:**
1. Capturar foto del producto vendido
2. Preprocesar imagen en cliente (redimensionar, normalizar)
3. Ejecutar inferencia local con modelo TensorFlow.js/ONNX.js
4. Generar 3 sugerencias ordenadas por confianza/precisión
5. Visualizar sugerencias con fotos de referencia de productos
6. Seleccionar producto correcto
7. Si confianza < 60%: mostrar error y opciones alternativas

---

## Criterios de Aceptación

### Escenario 1: Reconocimiento exitoso con alta confianza
**Dado que** capturo una foto de un producto que existe en el catálogo  
**Cuando** proceso la imagen  
**Entonces** el sistema genera 3 sugerencias ordenadas por confianza  
**Y** la primera sugerencia tiene confianza > 60%  
**Y** muestro las sugerencias con fotos de referencia  
**Y** puedo seleccionar el producto correcto

### Escenario 2: Reconocimiento con baja confianza
**Dado que** capturo una foto que no tiene correspondencia clara  
**Cuando** proceso la imagen  
**Y** ninguna sugerencia tiene confianza > 60%  
**Entonces** el sistema muestra mensaje: "No se encontró una correspondencia fiable"  
**Y** ofrece opciones:
  - Tomar otra foto
  - Registrar venta manual (redirigir a HU-EP3-002)

### Escenario 3: Visualizar sugerencias con fotos
**Dado que** el sistema genera sugerencias  
**Cuando** visualizo las sugerencias  
**Entonces** veo 3 productos con:
  - Foto de referencia principal
  - SKU
  - Nombre
  - Porcentaje de confianza
  - Ordenados de mayor a menor confianza

### Escenario 4: Seleccionar producto de las sugerencias
**Dado que** veo las sugerencias generadas  
**Cuando** selecciono un producto  
**Entonces** el producto seleccionado se pasa al flujo de venta  
**Y** continúo con validación de stock y selección de método de pago

### Escenario 5: Captura de foto desde dispositivo móvil
**Dado que** estoy en un dispositivo móvil  
**Cuando** accedo a la funcionalidad de reconocimiento  
**Entonces** puedo capturar foto usando la cámara del dispositivo  
**Y** la foto se procesa localmente sin enviar al servidor

---

## Notas adicionales

- **Procesamiento en cliente:** El modelo de IA se ejecuta en el dispositivo móvil (TensorFlow.js/ONNX.js)
- **Modelo:** Se descarga una vez y se ejecuta localmente para inferencia
- **Formato de fotos:** JPG, PNG (validar antes de procesar)
- **Umbral de confianza:** 60% configurable
- **Optimización:** Preprocesar imagen antes de inferencia (redimensionar a tamaño del modelo)

---

## Tareas

1. Backend: Endpoint para obtener modelo de IA (descarga inicial)
2. Backend: Endpoint para obtener fotos de referencia de productos
3. Frontend: Componente de captura de foto (cámara móvil)
4. Frontend: Integración con TensorFlow.js/ONNX.js para inferencia
5. Frontend: Componente de visualización de sugerencias
6. Frontend: Manejo de errores y redirección a venta manual

---

## Estimaciones y atributos de priorización

- **Puntos de historia:** _Pendiente_
- **Dependencias:** HU-EP1-004 (fotos de productos), modelo de IA entrenado
- **Complejidad:** Alta (integración con IA, procesamiento en cliente)

