# HU-EP8-001: Crear punto de venta

## Formato estándar

Como **administrador**, quiero **crear nuevos puntos de venta en el sistema** para **gestionar las diferentes ubicaciones donde se realizan las ventas**.

---

## Descripción

El sistema debe permitir a los administradores crear nuevos puntos de venta con información básica como nombre, código único, dirección, teléfono y email. Los puntos de venta son necesarios para organizar el inventario, las ventas y las asignaciones de operadores.

**Contexto de negocio:**
- Los puntos de venta pueden ser tiendas propias, hoteles, o tiendas de terceros
- Cada punto de venta necesita un código único para identificación rápida
- Los puntos de venta nuevos deben estar activos por defecto para poder usarse inmediatamente
- La información de contacto (dirección, teléfono, email) es útil para reportes y gestión (Fase 2)

**Flujo de uso:**
1. Administrador accede a la gestión de puntos de venta
2. Hace clic en "Crear nuevo punto de venta"
3. Completa el formulario con nombre, código, dirección, teléfono, email
4. Confirma la creación
5. El sistema crea el punto de venta y muestra confirmación

---

## Criterios de Aceptación

### Escenario 1: Crear punto de venta exitosamente
**Dado que** soy un administrador autenticado  
**Cuando** creo un nuevo punto de venta con:
- Nombre válido (ej: "Tienda Centro")
- Código único (ej: "TC-001")
- Dirección opcional
- Teléfono opcional
- Email opcional

**Entonces** el sistema crea el punto de venta exitosamente  
**Y** el punto de venta queda con `IsActive = true`  
**Y** se establecen `CreatedAt` y `UpdatedAt` con la fecha/hora actual  
**Y** se muestra mensaje de confirmación  
**Y** el punto de venta aparece en la lista de puntos de venta

### Escenario 2: Código duplicado
**Dado que** existe un punto de venta con código "TC-001"  
**Cuando** intento crear un nuevo punto de venta con el mismo código "TC-001"  
**Entonces** el sistema muestra un error: "El código del punto de venta ya está en uso"  
**Y** no se crea el punto de venta  
**Y** puedo corregir el código e intentar nuevamente

### Escenario 3: Validación de campos requeridos
**Dado que** estoy en el formulario de crear punto de venta  
**Cuando** intento crear un punto de venta sin completar campos obligatorios (nombre, código)  
**Entonces** el sistema muestra mensajes de validación indicando los campos requeridos  
**Y** no se crea el punto de venta

### Escenario 4: Validación de formato de email
**Dado que** estoy creando un punto de venta  
**Cuando** ingreso un email con formato inválido  
**Entonces** el sistema muestra un mensaje de validación: "El formato del email no es válido"  
**Y** no se crea el punto de venta hasta corregir el formato

### Escenario 5: Usuario no autorizado
**Dado que** soy un operador (no administrador)  
**Cuando** intento acceder a la funcionalidad de crear punto de venta  
**Entonces** el sistema me muestra un error de acceso denegado  
**Y** no puedo crear puntos de venta

---

## Notas adicionales

- **Campos del modelo de datos:**
  - `Name`: Obligatorio, texto
  - `Code`: Obligatorio, único, texto (usado para identificación rápida)
  - `Address`: Opcional, texto
  - `Phone`: Opcional, texto
  - `Email`: Opcional, texto (validar formato si se proporciona)
  - `IsActive`: Por defecto `true`

- **Validaciones:**
  - Código único en base de datos (constraint único)
  - Nombre no vacío
  - Email con formato válido si se proporciona

- **UX:**
  - Sugerir código automático basado en nombre (opcional)
  - Validación en tiempo real de código único

---

## Tareas

1. **Backend - Dominio:**
   - Implementar servicio de gestión de puntos de venta (`IPointOfSaleService`)
   - Implementar validación de unicidad de código

2. **Backend - API:**
   - Crear endpoint `POST /api/point-of-sales`
   - Validar entrada (campos requeridos, formato de email)
   - Verificar permisos (solo administradores)
   - Retornar datos del punto de venta creado

3. **Backend - Base de datos:**
   - Asegurar constraint único en `PointOfSale.Code`
   - Manejar excepciones de violación de constraints

4. **Frontend - UI:**
   - Crear formulario de creación de punto de venta
   - Implementar validación de campos en cliente
   - Mostrar mensajes de error apropiados

5. **Frontend - Servicios:**
   - Crear servicio para gestión de puntos de venta (`PointOfSaleService`)
   - Implementar llamada al endpoint de creación
   - Manejar errores (código duplicado)

6. **Testing:**
   - Tests unitarios para servicio de puntos de venta
   - Tests de integración para endpoint de creación
   - Tests de validación de campos
   - Tests de permisos (solo administradores)

---

## Estimaciones y atributos de priorización

> **Nota:** Estas estimaciones deben completarse en una sesión de refinamiento con el equipo.

- **Puntos de historia (Story Points):** _Pendiente_
- **Impacto en usuario / Valor de negocio (1-5):** _Pendiente_
- **Urgencia (mercado / feedback) (1-5):** _Pendiente_
- **Complejidad / Esfuerzo (1-5):** _Pendiente_
- **Riesgos y dependencias:**
  - Depende de HU-EP7-001 (login) y HU-EP7-006 (control de acceso)
  - Requiere tabla `PointOfSale` en base de datos
  - Base para asignación de operadores (HU-EP7-004) y gestión de inventario

